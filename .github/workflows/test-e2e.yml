name: Test / E2E Runner

on:
  pull_request:
    branches:
      - master

jobs:
  chrome_e2e_gammut_tests:
    name: >
      ${{
        format(
          'Chrome with WP{0} PHP{1} and {2} theme',
          matrix.wp,
          matrix.php,
          matrix.theme == '' && 'twentytwentythree' || 'go'
        )
      }}
    uses: ./.github/workflows/test-e2e-cypress.yml
    strategy:
      fail-fast: false
      matrix:
        wp: # Test against Prev-Prev Major, Prev-Major, and current Major release versions.
          - "6.2"
          - "6.3"
          # - "6.4" Should enable this when 6.4 is released.
        theme:
          - "https://downloads.wordpress.org/theme/go.zip"
          - "" # Default theme is twentytwentythree
        php: # Test against minimum and latest PHP versions.
          - "7.4"
          - "8.2"
    with:
      wpVersion: "WordPress/WordPress#${{matrix.wp}}"
      theme: ${{matrix.theme}}
      phpVersion: ${{matrix.php}}
    concurrency:
      group: >
        ${{
          format(
            'chrome-e2e-WP{0}-PHP{1}-{2}',
            matrix.wp,
            matrix.php,
            matrix.theme == '' && 'twentytwentythree' || 'go'
          )
        }}
      cancel-in-progress: true
